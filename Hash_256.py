import random
import copy
#给定一个起始点，获得对应的目标节点集以及对应的增益
def OneStartgain(HashSet=[],x=4, y=0, z=0, TIMES=28):

    #定义随机的哈希值
    #Hash=str('0001')
    GainDicsSet = dict()
    GainDicsSet['0000'] = {'0': 0, '1': 1, '2': 0, '3': 1, '4': 0, '01': 1, '02': 1, '03': 1, '04': 1, '12': 1, '13': 2,
                           '14': 1, '23': 1, '24': 1, '34': 1, '012': 2, '013': 2, '014': 2, '023': 2, '024': 2,
                           '034': 2, '123': 2, '124': 2, '134': 2, '234': 2, '0123': 3, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['0001'] = {'0': 1, '1': 1, '2': 1, '3': 1, '4': 0, '01': 2, '02': 2, '03': 2, '04': 1, '12': 2, '13': 2,
                           '14': 1, '23': 2, '24': 1, '34': 1, '012': 3, '013': 3, '014': 2, '023': 3, '024': 2,
                           '034': 2, '123': 3, '124': 2, '134': 2, '234': 2, '0123': 4, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['0010'] = {'0': 0, '1': 1, '2': 0, '3': 0, '4': 0, '01': 1, '02': 1, '03': 1, '04': 1, '12': 1, '13': 1,
                           '14': 1, '23': 1, '24': 1, '34': 1, '012': 2, '013': 2, '014': 2, '023': 2, '024': 2,
                           '034': 2, '123': 2, '124': 2, '134': 2, '234': 2, '0123': 3, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['0011'] = {'0': 1, '1': 1, '2': 1, '3': 0, '4': 0, '01': 2, '02': 2, '03': 1, '04': 1, '12': 2, '13': 1,
                           '14': 1, '23': 1, '24': 1, '34': 1, '012': 3, '013': 2, '014': 2, '023': 2, '024': 2,
                           '034': 2, '123': 2, '124': 2, '134': 2, '234': 2, '0123': 3, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['0100'] = {'0': 1, '1': 1, '2': 0, '3': 1, '4': 0, '01': 2, '02': 1, '03': 2, '04': 1, '12': 1, '13': 2,
                           '14': 1, '23': 1, '24': 1, '34': 1, '012': 2, '013': 3, '014': 2, '023': 2, '024': 2,
                           '034': 2, '123': 2, '124': 2, '134': 2, '234': 2, '0123': 3, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['0101'] = {'0': 1, '1': 1, '2': 1, '3': 1, '4': 0, '01': 2, '02': 2, '03': 2, '04': 1, '12': 2, '13': 2,
                           '14': 1, '23': 2, '24': 1, '34': 1, '012': 3, '013': 3, '014': 2, '023': 3, '024': 2,
                           '034': 2, '123': 3, '124': 2, '134': 2, '234': 2, '0123': 4, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['0110'] = {'0': 1, '1': 1, '2': 0, '3': 1, '4': 0, '01': 2, '02': 1, '03': 2, '04': 1, '12': 1, '13': 2,
                           '14': 1, '23': 1, '24': 1, '34': 1, '012': 2, '013': 3, '014': 2, '023': 2, '024': 2,
                           '034': 2, '123': 2, '124': 2, '134': 2, '234': 2, '0123': 3, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['0111'] = {'0': 1, '1': 1, '2': 1, '3': 1, '4': 0, '01': 2, '02': 2, '03': 2, '04': 1, '12': 2, '13': 2,
                           '14': 1, '23': 2, '24': 1, '34': 1, '012': 3, '013': 3, '014': 2, '023': 3, '024': 2,
                           '034': 2, '123': 3, '124': 2, '134': 2, '234': 2, '0123': 4, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['1000'] = {'0': 0, '1': 0, '2': 0, '3': 0, '4': 0, '01': 1, '02': 1, '03': 1, '04': 1, '12': 1, '13': 1,
                           '14': 1, '23': 1, '24': 1, '34': 1, '012': 2, '013': 2, '014': 2, '023': 2, '024': 2,
                           '034': 2, '123': 2, '124': 2, '134': 2, '234': 2, '0123': 3, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['1001'] = {'0': 1, '1': 0, '2': 1, '3': 0, '4': 0, '01': 1, '02': 2, '03': 1, '04': 1, '12': 1, '13': 1,
                           '14': 1, '23': 1, '24': 1, '34': 1, '012': 2, '013': 2, '014': 2, '023': 2, '024': 2,
                           '034': 2, '123': 2, '124': 2, '134': 2, '234': 2, '0123': 3, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['1010'] = {'0': 0, '1': 1, '2': 0, '3': 1, '4': 0, '01': 1, '02': 1, '03': 1, '04': 1, '12': 1, '13': 2,
                           '14': 1, '23': 1, '24': 1, '34': 1, '012': 2, '013': 2, '014': 2, '023': 2, '024': 2,
                           '034': 2, '123': 2, '124': 2, '134': 2, '234': 2, '0123': 3, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['1011'] = {'0': 1, '1': 1, '2': 1, '3': 1, '4': 0, '01': 2, '02': 2, '03': 2, '04': 1, '12': 2, '13': 2,
                           '14': 1, '23': 2, '24': 1, '34': 1, '012': 3, '013': 3, '014': 2, '023': 3, '024': 2,
                           '034': 2, '123': 3, '124': 2, '134': 2, '234': 2, '0123': 4, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['1100'] = {'0': 1, '1': 0, '2': 0, '3': 0, '4': 0, '01': 1, '02': 1, '03': 1, '04': 1, '12': 1, '13': 1,
                           '14': 1, '23': 1, '24': 1, '34': 1, '012': 2, '013': 2, '014': 2, '023': 2, '024': 2,
                           '034': 2, '123': 2, '124': 2, '134': 2, '234': 2, '0123': 3, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['1101'] = {'0': 1, '1': 0, '2': 1, '3': 0, '4': 0, '01': 1, '02': 2, '03': 1, '04': 1, '12': 1, '13': 1,
                           '14': 1, '23': 1, '24': 1, '34': 1, '012': 2, '013': 2, '014': 2, '023': 2, '024': 2,
                           '034': 2, '123': 2, '124': 2, '134': 2, '234': 2, '0123': 3, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['1110'] = {'0': 1, '1': 1, '2': 0, '3': 0, '4': 0, '01': 2, '02': 1, '03': 1, '04': 1, '12': 1, '13': 1,
                           '14': 1, '23': 1, '24': 1, '34': 1, '012': 2, '013': 2, '014': 2, '023': 2, '024': 2,
                           '034': 2, '123': 2, '124': 2, '134': 2, '234': 2, '0123': 3, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['1111'] = {'0': 1, '1': 1, '2': 1, '3': 0, '4': 0, '01': 2, '02': 2, '03': 1, '04': 1, '12': 2, '13': 1,
                           '14': 1, '23': 1, '24': 1, '34': 1, '012': 3, '013': 2, '014': 2, '023': 2, '024': 2,
                           '034': 2, '123': 2, '124': 2, '134': 2, '234': 2, '0123': 3, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}

    # 定义存目标节点的字典
    ObjDic = dict()
    # 目标节点字典的key为str，value为列表
    for key in range(64):
        ObjDic[str(key)] = list()

    i = 0
    # 给定起点，循环TIMES次获得一个目标节点集
    while i < TIMES:
        # 根据起点得到目标节点obj1的z旋转量
        if (x - 1) % 5 == 0:
            r1 = 0
        elif (x - 1) % 5 == 1:
            r1 = 300
        elif (x - 1) % 5 == 2:
            r1 = 171
        elif (x - 1) % 5 == 3:
            r1 = 21
        elif (x - 1) % 5 == 4:
            r1 = 78

        # 根据起点得到目标节点obj2的z旋转量
        if x == 0:
            r2 = 0
        elif x == 1:
            r2 = 300
        elif x == 2:
            r2 = 171
        elif x == 3:
            r2 = 21
        elif x == 4:
            r2 = 78

        # 定义两个目标节点obj1，obj2
        obj1 = ((x - 1) % 5, 0, (z + r1) % 64)  # 由常数列影响得到的目标线性化位置
        obj2 = (x, 0, (z + r2) % 64)  # 由常数单bit影响得到的目标线性化位置
        ObjDic[str(obj1[2])].append(obj1[0])
        ObjDic[str(obj2[2])].append(obj2[0])
        # print("obj1:{}    obj2:{}".format(obj1,obj2))

        # 更新起点
        (x, y, z) = ((x + 2) % 5, y, (z - 1) % 64)
        i += 1

    # 对value进行排序，与增益表对应
    for key in ObjDic.keys():
        ObjDic[key].sort()

    GAIN = 0
    # 对一个目标节点表计算对应的增益（每个slice给一个随机的哈希值）
    for slice in range(64):
        key = str(slice)
        GainDict = GainDicsSet[HashSet[slice]]
        if ObjDic[key] == []:
            continue
        # 增益表的key与目标节点的表的value相对应
        thiskey = ''
        for thissite in ObjDic[key]:
            thiskey += str(thissite)
        thisgain = GainDict[thiskey]
        GAIN += thisgain
        # print(GAIN)
    return GAIN, ObjDic

#给定一个起始点，获得对应的目标节点集以及对应的增益(需覆盖)
def GetObjdic(x=4, y=0, z=0, TIMES=28):

    #预计算的增益表
    GainDic = {'0': 0.75, '1': 0.75, '2': 0.5, '3': 0.5, '4': 0, '01': 1.5625, '02': 1.5, '03': 1.375, '04': 1,
               '12': 1.375, '13': 1.5, '14': 1, '23': 1.25, '24': 1, '34': 1, '012': 2.375, '013': 2.375, '014': 2,
               '023': 2.25, '024': 2, '034': 2, '123': 2.25, '124': 2, '134': 2, '234': 2, '0123': 3.25, '0124': 3,
               '0134': 3, '0234': 3, '1234': 3, '01234': 4}

    #定义存目标节点的字典
    ObjDic = dict()
    #目标节点字典的key为str，value为列表
    for key in range(64):
        ObjDic[str(key)] = list()

    i = 0
    #给定起点，循环TIMES次获得一个目标节点集
    while i < TIMES:
        #根据起点得到目标节点obj1的z旋转量
        if (x - 1) % 5 == 0:
            r1 = 0
        elif (x - 1) % 5 == 1:
            r1 = 300
        elif (x - 1) % 5 == 2:
            r1 = 171
        elif (x - 1) % 5 == 3:
            r1 = 21
        elif (x - 1) % 5 == 4:
            r1 = 78

        # 根据起点得到目标节点obj2的z旋转量
        if x == 0:
            r2 = 0
        elif x == 1:
            r2 = 300
        elif x == 2:
            r2 = 171
        elif x == 3:
            r2 = 21
        elif x == 4:
            r2 = 78

        #定义两个目标节点obj1，obj2
        obj1 = ((x - 1) % 5, 0, (z + r1) % 64)  # 由常数列影响得到的目标线性化位置
        obj2 = (x, 0, (z + r2) % 64)  # 由常数单bit影响得到的目标线性化位置
        ObjDic[str(obj1[2])].append(obj1[0])
        ObjDic[str(obj2[2])].append(obj2[0])
        #print("obj1:{}    obj2:{}".format(obj1,obj2))

        #更新起点
        (x, y, z) = ((x + 2) % 5, y, (z - 1) % 64)
        i += 1

    #对value进行排序，与增益表对应
    for key in ObjDic.keys():
        ObjDic[key].sort()

    GAIN = 0
    #对一个目标节点表计算对应的增益
    for key in ObjDic.keys():
        if ObjDic[key] == []:
            continue
        #增益表的key与目标节点的表的value相对应
        thiskey= ''
        for thissite in ObjDic[key]:
            thiskey += str(thissite)
        thisgain = GainDic[thiskey]
        GAIN += thisgain
        # print(GAIN)
    return GAIN, ObjDic
# 为每个slice生成一个随机哈希值并获取对应的增益表，对一个确定的目标节点集计算增益
def GetDictGain(HashValueList, Objset):
    #HashValueList为一个64个hash值组成的列表,Objset为目标节点集
    # GainDic = {'0': 0.75, '1': 0.75, '2': 0.5, '3': 0.5, '4': 0, '01': 1.5625, '02': 1.5, '03': 1.375, '04': 1,
    #            '12': 1.375, '13': 1.5, '14': 1, '23': 1.25, '24': 1, '34': 1, '012': 2.375, '013': 2.375, '014': 2,
    #            '023': 2.25, '024': 2, '034': 2, '123': 2.25, '124': 2, '134': 2, '234': 2, '0123': 3.25, '0124': 3,
    #            '0134': 3, '0234': 3, '1234': 3, '01234': 4}

    GainDicsSet = dict()
    GainDicsSet['0000'] = {'0': 0, '1': 1, '2': 0, '3': 1, '4': 0, '01': 1, '02': 1, '03': 1, '04': 1, '12': 1, '13': 2,
                           '14': 1, '23': 1, '24': 1, '34': 1, '012': 2, '013': 2, '014': 2, '023': 2, '024': 2,
                           '034': 2, '123': 2, '124': 2, '134': 2, '234': 2, '0123': 3, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['0001'] = {'0': 1, '1': 1, '2': 1, '3': 1, '4': 0, '01': 2, '02': 2, '03': 2, '04': 1, '12': 2, '13': 2,
                           '14': 1, '23': 2, '24': 1, '34': 1, '012': 3, '013': 3, '014': 2, '023': 3, '024': 2,
                           '034': 2, '123': 3, '124': 2, '134': 2, '234': 2, '0123': 4, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['0010'] = {'0': 0, '1': 1, '2': 0, '3': 0, '4': 0, '01': 1, '02': 1, '03': 1, '04': 1, '12': 1, '13': 1,
                           '14': 1, '23': 1, '24': 1, '34': 1, '012': 2, '013': 2, '014': 2, '023': 2, '024': 2,
                           '034': 2, '123': 2, '124': 2, '134': 2, '234': 2, '0123': 3, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['0011'] = {'0': 1, '1': 1, '2': 1, '3': 0, '4': 0, '01': 2, '02': 2, '03': 1, '04': 1, '12': 2, '13': 1,
                           '14': 1, '23': 1, '24': 1, '34': 1, '012': 3, '013': 2, '014': 2, '023': 2, '024': 2,
                           '034': 2, '123': 2, '124': 2, '134': 2, '234': 2, '0123': 3, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['0100'] = {'0': 1, '1': 1, '2': 0, '3': 1, '4': 0, '01': 2, '02': 1, '03': 2, '04': 1, '12': 1, '13': 2,
                           '14': 1, '23': 1, '24': 1, '34': 1, '012': 2, '013': 3, '014': 2, '023': 2, '024': 2,
                           '034': 2, '123': 2, '124': 2, '134': 2, '234': 2, '0123': 3, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['0101'] = {'0': 1, '1': 1, '2': 1, '3': 1, '4': 0, '01': 2, '02': 2, '03': 2, '04': 1, '12': 2, '13': 2,
                           '14': 1, '23': 2, '24': 1, '34': 1, '012': 3, '013': 3, '014': 2, '023': 3, '024': 2,
                           '034': 2, '123': 3, '124': 2, '134': 2, '234': 2, '0123': 4, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['0110'] = {'0': 1, '1': 1, '2': 0, '3': 1, '4': 0, '01': 2, '02': 1, '03': 2, '04': 1, '12': 1, '13': 2,
                           '14': 1, '23': 1, '24': 1, '34': 1, '012': 2, '013': 3, '014': 2, '023': 2, '024': 2,
                           '034': 2, '123': 2, '124': 2, '134': 2, '234': 2, '0123': 3, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['0111'] = {'0': 1, '1': 1, '2': 1, '3': 1, '4': 0, '01': 2, '02': 2, '03': 2, '04': 1, '12': 2, '13': 2,
                           '14': 1, '23': 2, '24': 1, '34': 1, '012': 3, '013': 3, '014': 2, '023': 3, '024': 2,
                           '034': 2, '123': 3, '124': 2, '134': 2, '234': 2, '0123': 4, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['1000'] = {'0': 0, '1': 0, '2': 0, '3': 0, '4': 0, '01': 1, '02': 1, '03': 1, '04': 1, '12': 1, '13': 1,
                           '14': 1, '23': 1, '24': 1, '34': 1, '012': 2, '013': 2, '014': 2, '023': 2, '024': 2,
                           '034': 2, '123': 2, '124': 2, '134': 2, '234': 2, '0123': 3, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['1001'] = {'0': 1, '1': 0, '2': 1, '3': 0, '4': 0, '01': 1, '02': 2, '03': 1, '04': 1, '12': 1, '13': 1,
                           '14': 1, '23': 1, '24': 1, '34': 1, '012': 2, '013': 2, '014': 2, '023': 2, '024': 2,
                           '034': 2, '123': 2, '124': 2, '134': 2, '234': 2, '0123': 3, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['1010'] = {'0': 0, '1': 1, '2': 0, '3': 1, '4': 0, '01': 1, '02': 1, '03': 1, '04': 1, '12': 1, '13': 2,
                           '14': 1, '23': 1, '24': 1, '34': 1, '012': 2, '013': 2, '014': 2, '023': 2, '024': 2,
                           '034': 2, '123': 2, '124': 2, '134': 2, '234': 2, '0123': 3, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['1011'] = {'0': 1, '1': 1, '2': 1, '3': 1, '4': 0, '01': 2, '02': 2, '03': 2, '04': 1, '12': 2, '13': 2,
                           '14': 1, '23': 2, '24': 1, '34': 1, '012': 3, '013': 3, '014': 2, '023': 3, '024': 2,
                           '034': 2, '123': 3, '124': 2, '134': 2, '234': 2, '0123': 4, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['1100'] = {'0': 1, '1': 0, '2': 0, '3': 0, '4': 0, '01': 1, '02': 1, '03': 1, '04': 1, '12': 1, '13': 1,
                           '14': 1, '23': 1, '24': 1, '34': 1, '012': 2, '013': 2, '014': 2, '023': 2, '024': 2,
                           '034': 2, '123': 2, '124': 2, '134': 2, '234': 2, '0123': 3, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['1101'] = {'0': 1, '1': 0, '2': 1, '3': 0, '4': 0, '01': 1, '02': 2, '03': 1, '04': 1, '12': 1, '13': 1,
                           '14': 1, '23': 1, '24': 1, '34': 1, '012': 2, '013': 2, '014': 2, '023': 2, '024': 2,
                           '034': 2, '123': 2, '124': 2, '134': 2, '234': 2, '0123': 3, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['1110'] = {'0': 1, '1': 1, '2': 0, '3': 0, '4': 0, '01': 2, '02': 1, '03': 1, '04': 1, '12': 1, '13': 1,
                           '14': 1, '23': 1, '24': 1, '34': 1, '012': 2, '013': 2, '014': 2, '023': 2, '024': 2,
                           '034': 2, '123': 2, '124': 2, '134': 2, '234': 2, '0123': 3, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}
    GainDicsSet['1111'] = {'0': 1, '1': 1, '2': 1, '3': 0, '4': 0, '01': 2, '02': 2, '03': 1, '04': 1, '12': 2, '13': 1,
                           '14': 1, '23': 1, '24': 1, '34': 1, '012': 3, '013': 2, '014': 2, '023': 2, '024': 2,
                           '034': 2, '123': 2, '124': 2, '134': 2, '234': 2, '0123': 3, '0124': 3, '0134': 3, '0234': 3,
                           '1234': 3, '01234': 4}

    GAIN = 0
    for slice in range(64):
        key = str(slice)
        GainDic = GainDicsSet[HashValueList[slice]]
        if Objset[key] == []:
            continue
        thisstr = ''
        for thissite in Objset[key]:
            thisstr += str(thissite)
        thisgain = GainDic[thisstr]
        GAIN += thisgain
    return GAIN

# 两起点获得目标节点数量
def GetSiteNumber(thisobjset1):
    objnum = 0
    for key in thisobjset1.keys():
        setlist = thisobjset1[key]
        thislen = len(setlist)
        objnum += thislen
    return objnum

#获得两个起点分别得到的目标节点字典，两个表合并到thisobjset1
def MergeTwodict(thisobjset1, thisobjset2):

    mergedict = copy.deepcopy(thisobjset1)
    for key in mergedict.keys():
        set2list = thisobjset2[key]
        mergedict[key].extend(set2list)
        mergedict[key] = list(set(mergedict[key]))
        mergedict[key].sort()
    return mergedict

#合并两个列表
def MergeTwolist(thislist1,thislist2):
    mergelist = list(set(thislist1+thislist2))
    return mergelist

#由给定起点得到需要限制的Π中的bit列表
def GetConstraint(x,y,z,TIMES):
    Constraintlist=list()

    # Constraintlist.append((x,y,z))

    #把起始那一列都加到列表里
    y=0
    while y<5:
        startcolumn=(x,y,z)
        Constraintlist.append(startcolumn)
        y=y+1
    y=y%5

    #一列的起点
    (x2,y2,z2)=((x+2)%5,y,(z-1)%64)
    #第一列添加到列表
    while y2 < 5:
        columnstartsite = (x2, y2, z2)
        Constraintlist.append(columnstartsite)
        y2 = y2 + 1
    y2 = y2 % 5
    #得到单比特限制的起始点
    solitorystartsite = ((x + 2) % 5, (y + 4) % 5, z)
    (x1,y1,z1)= solitorystartsite
    #第一单bit添加到列表
    Constraintlist.append(solitorystartsite)

    i = 0
    # 给定起点，循环TIMES次获得一个目标节点集
    while i < TIMES:
        while y2 < 5:
            conlumnsite=((x2+2)%5,y2,(z2-1)%64)
            Constraintlist.append(conlumnsite)
            y2 = y2 + 1
        solitorysite = ((x1 + 2) % 5, (y1 + 2) % 5, (z1-1)%64)

        Constraintlist.append(solitorysite)
        # 更新起点
        (x1,y1,z1)= ((x1 + 2) % 5, (y1 + 2) % 5, (z1-1)%64)
        (x2,y2,z2)=((x2+2)%5,y2%5,(z2-1)%64)
        i += 1
    return Constraintlist

#获得对应的θ列表
def GetFreedom(Constraintlist):
    #θ和Π的x、y坐标对应关系
    Transdic={'00':'00','01':'30','02':'10','03':'40','04':'20','10':'11','11':'41','12':'21','13':'01','14':'31','20':'22','21':'02','22':'32','23':'12','24':'42','30':'33','31':'13','32':'43','33':'23','34':'03','40':'44','41':'24','42':'04','43':'34','44':'14'}

    #用θ的xy与旋转量r的对应关系
    GetRdic={'00':'0','01':'36','02':'3','03':'105','04':'210','10':'1','11':'300','12':'10','13':'45','14':'66','20':'190','21':'6','22':'171','23':'15','24':'253','30':'28','31':'55','32':'153','33':'21','34':'120','40':'91','41':'276','42':'231','43':'136','44':'78'}
    Variablelist=['00','04','12','13','20','21','33','34','41','42']
    # 存对应的θ
    getTranslist=list()
    thiskey = ''

    for value in Constraintlist:
        #取出Π，并将其xy坐标作为key
        thiskey +=str(value[0])
        thiskey += str(value[1])
        #得到θ的xy坐标
        thisxy=Transdic[thiskey]
        x=int(thisxy[0])
        y=int(thisxy[1])
        #得到旋转变量r和z坐标
        r=int(GetRdic[thisxy])
        z=int(value[2])
        z=((64*6+z-r)%64)
        getTranslist.append((x,y,z))
        thiskey = ''
    freedic = dict()
    n = len(getTranslist)

    i = 0
    while i < n:
        thiskey = ''
        thisvariable=''
        value = getTranslist[i]
        thisvariable+=str((value[0]))
        thisvariable+=str(value[1])

        if thisvariable not in Variablelist:
            thisvalue = str(value[1])
            thiskey += str(value[0])
            thiskey += str(value[2])
            freedic.setdefault(thiskey, []).append(thisvalue)
        i += 1
    # print('freedic:{}'.format(freedic))
    returnlist=list() #记录所有满足返回自由度的对
    for thiskey in freedic.keys():
        thislen=len(freedic[thiskey]) #记录同列同slice时对应的节点个数
        #如果同列同slice时对应的节点个数大于1，将对应的y值添加到列表中
        if thislen >1:
            # print('ture:{}'.format(freedic[thiskey]))
            returnlist.append(freedic[thiskey])
            # print(thislen)
    returnnum=len(returnlist) #列表中的元素个数即为返回自由度的个数（同列同slice时对应的节点个数等于2时）
    # print(returnnum)
    return getTranslist,returnnum


#
# if __name__=="__main__":
#     i=0
#     while i <10:
#         HashValueSet = ['0000','0001','0010','0011','0100','0101','0110','0111','1000','1001','1010','1011','1100','1101','1110','1111']
#         HashValuelist = []
#         for slice in range(64):
#             thisvalue = random.randint(0, 15)
#             HashValuelist.append(HashValueSet[thisvalue])
#         print('HashValuelist:{}'.format(HashValuelist))
#
#         maxGain = -1
#         for TIMES in range(29):
#         # TIMES = 28
#             CONSTRAINTS = 5*(TIMES>0)+6*TIMES
#             print('TIMES:{}         CONSTRAINT:{}'.format(TIMES,CONSTRAINTS))
#             for x in range(5):
#                 for z in range(63):
#                     thisgain, thisobjset = OneStartgain(HashValuelist,x, 0, z, TIMES)
#                     thisObjnum = GetSiteNumber(thisobjset)
#                     if thisgain > maxGain:
#                         maxGain = thisgain
#                         startpoint=(x,0,z)
#                         thisConstraintlist=GetConstraint(x,0,z,TIMES-1)
#                         thisTranlist,thisfreedomnum=GetFreedom((thisConstraintlist))
#                         continue
#             print('thisfreedomreturn:{}    thisconstraint:{}     '.format(thisfreedomnum,thisConstraintlist,))
#             print("maxgain:{}  maxstart:{}   objnum:{}".format(maxGain,startpoint,thisObjnum))
#             print('--------------------------------------------------------------------------------')
#         i+=1
#

